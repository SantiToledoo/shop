{% extends 'base.html' %}

{% block content %}
<div class="page-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="{{ url_for('main.index') }}" class="breadcrumb-link">Productos</a>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-current">{{ producto.nombre }}</span>
    </nav>

    <!-- Detalle del producto -->
    <div class="product-detail">
        <div class="product-gallery">
            <div class="main-image">
                <img src="{{ producto.imagen_url }}" alt="{{ producto.nombre }}" class="product-image">
            </div>
        </div>

        <div class="product-info-detail">
            <h1 class="product-title">{{ producto.nombre }}</h1>
            
            <div class="product-price-section">
                <span class="product-price-large">${{ producto.precio }}</span>
                {% if producto.stock > 0 %}
                    <span class="stock-badge stock-available">En stock ({{ producto.stock }} disponibles)</span>
                {% else %}
                    <span class="stock-badge stock-unavailable">Sin stock</span>
                {% endif %}
            </div>

            <div class="product-description-section">
                <h3 class="section-title">Descripción</h3>
                <p class="product-description-detail">{{ producto.descripcion }}</p>
            </div>

            {% set talles = producto.variantes | selectattr("tipo", "equalto", "talle") | list %}
            {% set colores = producto.variantes | selectattr("tipo", "equalto", "color") | list %}

            {% if producto.stock > 0 %}
                <form action="{{ url_for('admin.agregar_al_carrito', producto_id=producto.id) }}" method="POST" class="add-to-cart-form">

                    <!-- Cantidad -->
                    <div class="quantity-section">
                        <label for="cantidad" class="quantity-label">Cantidad:</label>
                        <div class="quantity-controls">
                            <button type="button" class="quantity-btn" onclick="decreaseQuantity()">-</button>
                            <input type="number" name="cantidad" id="cantidad" value="1" min="1" max="{{ producto.stock }}" class="quantity-input">
                            <button type="button" class="quantity-btn" onclick="increaseQuantity()">+</button>
                        </div>
                    </div>

                    <!-- Talle -->
                    {% if talles %}
                    <div class="input-group">
                        <label for="talle">Talle:</label>
                        <select name="talle" id="talle" required>
                            <option value="">Seleccione</option>
                            {% for t in talles %}
                                <option value="{{ t.valor }}">{{ t.valor }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <!-- Color -->
                    {% if colores %}
                    <div class="input-group">
                        <label for="color">Color:</label>
                        <select name="color" id="color" required>
                            <option value="">Seleccione</option>
                            {% for c in colores %}
                                <option value="{{ c.valor }}">{{ c.valor }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <button type="submit" class="btn-primary btn-large btn-full add-to-cart-btn">
                        Agregar al Carrito
                    </button>
                </form>
            {% else %}
                <div class="out-of-stock-section">
                    <button class="btn-secondary btn-large btn-full" disabled>
                        Producto sin stock
                    </button>
                </div>
            {% endif %}

        </div>
    </div>

    <!-- Productos similares -->
    {% if similares %}
        <div class="similar-products-section">
            <h3 class="section-title-large">Productos Similares</h3>
            <div class="similar-products-grid">
                {% for sim in similares %}
                    <div class="similar-product-card">
                        <a href="{{ url_for('admin.detalle_producto', id=sim.id) }}" class="similar-product-link">
                            <div class="similar-product-image">
                                <img src="{{ sim.imagen_url }}" alt="{{ sim.nombre }}" class="similar-img">
                            </div>
                            <div class="similar-product-info">
                                <h4 class="similar-product-name">{{ sim.nombre }}</h4>
                                <span class="similar-product-price">${{ sim.precio }}</span>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>

<script>
function increaseQuantity() {
    const input = document.getElementById('cantidad');
    const max = parseInt(input.getAttribute('max'));
    const current = parseInt(input.value);
    if (current < max) input.value = current + 1;
}

function decreaseQuantity() {
    const input = document.getElementById('cantidad');
    const min = parseInt(input.getAttribute('min'));
    const current = parseInt(input.value);
    if (current > min) input.value = current - 1;
}
</script>
{% endblock %}
